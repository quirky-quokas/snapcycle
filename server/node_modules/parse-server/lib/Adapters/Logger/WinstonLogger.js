"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.configureLogger = configureLogger;
exports.addTransport = addTransport;
exports.removeTransport = removeTransport;
exports.default = exports.logger = void 0;

var _winston = _interopRequireWildcard(require("winston"));

var _fs = _interopRequireDefault(require("fs"));

var _path = _interopRequireDefault(require("path"));

var _winstonDailyRotateFile = _interopRequireDefault(require("winston-daily-rotate-file"));

var _lodash = _interopRequireDefault(require("lodash"));

var _defaults = _interopRequireDefault(require("../../defaults"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {}; if (desc.get || desc.set) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } } newObj.default = obj; return newObj; } }

const logger = _winston.default.createLogger();

exports.logger = logger;

function configureTransports(options) {
  const transports = [];

  if (options) {
    const silent = options.silent;
    delete options.silent;

    if (!_lodash.default.isNil(options.dirname)) {
      const parseServer = new _winstonDailyRotateFile.default(Object.assign({
        filename: 'parse-server.info',
        json: true,
        format: _winston.format.combine(_winston.format.timestamp(), _winston.format.json())
      }, options));
      parseServer.name = 'parse-server';
      transports.push(parseServer);
      const parseServerError = new _winstonDailyRotateFile.default(Object.assign({
        filename: 'parse-server.err',
        json: true,
        format: _winston.format.combine(_winston.format.timestamp(), _winston.format.splat(), _winston.format.json())
      }, options, {
        level: 'error'
      }));
      parseServerError.name = 'parse-server-error';
      transports.push(parseServerError);
    }

    const consoleFormat = options.json ? _winston.format.json() : _winston.format.simple();
    const consoleOptions = Object.assign({
      colorize: true,
      name: 'console',
      silent,
      format: consoleFormat
    }, options);
    transports.push(new _winston.default.transports.Console(consoleOptions));
  }

  logger.configure({
    transports
  });
}

function configureLogger({
  logsFolder = _defaults.default.logsFolder,
  jsonLogs = _defaults.default.jsonLogs,
  logLevel = _winston.default.level,
  verbose = _defaults.default.verbose,
  silent = _defaults.default.silent
} = {}) {
  if (verbose) {
    logLevel = 'verbose';
  }

  _winston.default.level = logLevel;
  const options = {};

  if (logsFolder) {
    if (!_path.default.isAbsolute(logsFolder)) {
      logsFolder = _path.default.resolve(process.cwd(), logsFolder);
    }

    try {
      _fs.default.mkdirSync(logsFolder);
    } catch (e) {
      /* */
    }
  }

  options.dirname = logsFolder;
  options.level = logLevel;
  options.silent = silent;

  if (jsonLogs) {
    options.json = true;
    options.stringify = true;
  }

  configureTransports(options);
}

function addTransport(transport) {
  // we will remove the existing transport
  // before replacing it with a new one
  removeTransport(transport.name);
  logger.add(transport);
}

function removeTransport(transport) {
  const matchingTransport = logger.transports.find(t1 => {
    return typeof transport === 'string' ? t1.name === transport : t1 === transport;
  });

  if (matchingTransport) {
    logger.remove(matchingTransport);
  }
}

var _default = logger;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9BZGFwdGVycy9Mb2dnZXIvV2luc3RvbkxvZ2dlci5qcyJdLCJuYW1lcyI6WyJsb2dnZXIiLCJ3aW5zdG9uIiwiY3JlYXRlTG9nZ2VyIiwiY29uZmlndXJlVHJhbnNwb3J0cyIsIm9wdGlvbnMiLCJ0cmFuc3BvcnRzIiwic2lsZW50IiwiXyIsImlzTmlsIiwiZGlybmFtZSIsInBhcnNlU2VydmVyIiwiRGFpbHlSb3RhdGVGaWxlIiwiT2JqZWN0IiwiYXNzaWduIiwiZmlsZW5hbWUiLCJqc29uIiwiZm9ybWF0IiwiY29tYmluZSIsInRpbWVzdGFtcCIsIm5hbWUiLCJwdXNoIiwicGFyc2VTZXJ2ZXJFcnJvciIsInNwbGF0IiwibGV2ZWwiLCJjb25zb2xlRm9ybWF0Iiwic2ltcGxlIiwiY29uc29sZU9wdGlvbnMiLCJjb2xvcml6ZSIsIkNvbnNvbGUiLCJjb25maWd1cmUiLCJjb25maWd1cmVMb2dnZXIiLCJsb2dzRm9sZGVyIiwiZGVmYXVsdHMiLCJqc29uTG9ncyIsImxvZ0xldmVsIiwidmVyYm9zZSIsInBhdGgiLCJpc0Fic29sdXRlIiwicmVzb2x2ZSIsInByb2Nlc3MiLCJjd2QiLCJmcyIsIm1rZGlyU3luYyIsImUiLCJzdHJpbmdpZnkiLCJhZGRUcmFuc3BvcnQiLCJ0cmFuc3BvcnQiLCJyZW1vdmVUcmFuc3BvcnQiLCJhZGQiLCJtYXRjaGluZ1RyYW5zcG9ydCIsImZpbmQiLCJ0MSIsInJlbW92ZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7Ozs7QUFFQSxNQUFNQSxNQUFNLEdBQUdDLGlCQUFRQyxZQUFSLEVBQWY7Ozs7QUFFQSxTQUFTQyxtQkFBVCxDQUE2QkMsT0FBN0IsRUFBc0M7QUFDcEMsUUFBTUMsVUFBVSxHQUFHLEVBQW5COztBQUNBLE1BQUlELE9BQUosRUFBYTtBQUNYLFVBQU1FLE1BQU0sR0FBR0YsT0FBTyxDQUFDRSxNQUF2QjtBQUNBLFdBQU9G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QUNLLE9BQVIsR0FBa0JzQixVQUFsQjtBQUNBM0IsRUFBQUEsT0FBTyxDQUFDbUIsS0FBUixHQUFnQlcsUUFBaEI7QUFDQTlCLEVBQUFBLE9BQU8sQ0FBQ0UsTUFBUixHQUFpQkEsTUFBakI7O0FBRUEsTUFBSTJCLFFBQUosRUFBYztBQUNaN0IsSUFBQUEsT0FBTyxDQUFDVyxJQUFSLEdBQWUsSUFBZjtBQUNBWCxJQUFBQSxPQUFPLENBQUN3QyxTQUFSLEdBQW9CLElBQXBCO0FBQ0Q7O0FBQ0R6QyxFQUFBQSxtQkFBbUIsQ0FBQ0MsT0FBRCxDQUFuQjtBQUNEOztBQUVNLFNBQVN5QyxZQUFULENBQXNCQyxTQUF0QixFQUFpQztBQUN0QztBQUNBO0FBQ0FDLEVBQUFBLGVBQWUsQ0FBQ0QsU0FBUyxDQUFDM0IsSUFBWCxDQUFmO0FBRUFuQixFQUFBQSxNQUFNLENBQUNnRCxHQUFQLENBQVdGLFNBQVg7QUFDRDs7QUFFTSxTQUFTQyxlQUFULENBQXlCRCxTQUF6QixFQUFvQztBQUN6QyxRQUFNRyxpQkFBaUIsR0FBR2pELE1BQU0sQ0FBQ0ssVUFBUCxDQUFrQjZDLElBQWxCLENBQXVCQyxFQUFFLElBQUk7QUFDckQsV0FBTyxPQUFPTCxTQUFQLEtBQXFCLFFBQXJCLEdBQ0hLLEVBQUUsQ0FBQ2hDLElBQUgsS0FBWTJCLFNBRFQsR0FFSEssRUFBRSxLQUFLTCxTQUZYO0FBR0QsR0FKeUIsQ0FBMUI7O0FBTUEsTUFBSUcsaUJBQUosRUFBdUI7QUFDckJqRCxJQUFBQSxNQUFNLENBQUNvRCxNQUFQLENBQWNILGlCQUFkO0FBQ0Q7QUFDRjs7ZUFHY2pELE0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgd2luc3RvbiwgeyBmb3JtYXQgfSBmcm9tICd3aW5zdG9uJztcbmltcG9ydCBmcyBmcm9tICdmcyc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCBEYWlseVJvdGF0ZUZpbGUgZnJvbSAnd2luc3Rvbi1kYWlseS1yb3RhdGUtZmlsZSc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IGRlZmF1bHRzIGZyb20gJy4uLy4uL2RlZmF1bHRzJztcblxuY29uc3QgbG9nZ2VyID0gd2luc3Rvbi5jcmVhdGVMb2dnZXIoKTtcblxuZnVuY3Rpb24gY29uZmlndXJlVHJhbnNwb3J0cyhvcHRpb25zKSB7XG4gIGNvbnN0IHRyYW5zcG9ydHMgPSBbXTtcbiAgaWYgKG9wdGlvbnMpIHtcbiAgICBjb25zdCBzaWxlbnQgPSBvcHRpb25zLnNpbGVudDtcbiAgICBkZWxldGUgb3B0aW9ucy5zaWxlbnQ7XG5cbiAgICBpZiAoIV8uaXNOaWwob3B0aW9ucy5kaXJuYW1lKSkge1xuICAgICAgY29uc3QgcGFyc2VTZXJ2ZXIgPSBuZXcgRGFpbHlSb3RhdGVGaWxlKFxuICAgICAgICBPYmplY3QuYXNzaWduKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpbGVuYW1lOiAncGFyc2Utc2VydmVyLmluZm8nLFxuICAgICAgICAgICAganNvbjogdHJ1ZSxcbiAgICAgICAgICAgIGZvcm1hdDogZm9ybWF0LmNvbWJpbmUoZm9ybWF0LnRpbWVzdGFtcCgpLCBmb3JtYXQuanNvbigpKSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIG9wdGlvbnNcbiAgICAgICAgKVxuICAgICAgKTtcbiAgICAgIHBhcnNlU2VydmVyLm5hbWUgPSAncGFyc2Utc2VydmVyJztcbiAgICAgIHRyYW5zcG9ydHMucHVzaChwYXJzZVNlcnZlcik7XG5cbiAgICAgIGNvbnN0IHBhcnNlU2VydmVyRXJyb3IgPSBuZXcgRGFpbHlSb3RhdGVGaWxlKFxuICAgICAgICBPYmplY3QuYXNzaWduKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGZpbGVuYW1lOiAncGFyc2Utc2VydmVyLmVycicsXG4gICAgICAgICAgICBqc29uOiB0cnVlLFxuICAgICAgICAgICAgZm9ybWF0OiBmb3JtYXQuY29tYmluZShcbiAgICAgICAgICAgICAgZm9ybWF0LnRpbWVzdGFtcCgpLFxuICAgICAgICAgICAgICBmb3JtYXQuc3BsYXQoKSxcbiAgICAgICAgICAgICAgZm9ybWF0Lmpzb24oKVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIG9wdGlvbnMsXG4gICAgICAgICAgeyBsZXZlbDogJ2Vycm9yJyB9XG4gICAgICAgIClcbiAgICAgICk7XG4gICAgICBwYXJzZVNlcnZlckVycm9yLm5hbWUgPSAncGFyc2Utc2VydmVyLWVycm9yJztcbiAgICAgIHRyYW5zcG9ydHMucHVzaChwYXJzZVNlcnZlckVycm9yKTtcbiAgICB9XG5cbiAgICBjb25zdCBjb25zb2xlRm9ybWF0ID0gb3B0aW9ucy5qc29uID8gZm9ybWF0Lmpzb24oKSA6IGZvcm1hdC5zaW1wbGUoKTtcbiAgICBjb25zdCBjb25zb2xlT3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oXG4gICAgICB7XG4gICAgICAgIGNvbG9yaXplOiB0cnVlLFxuICAgICAgICBuYW1lOiAnY29uc29sZScsXG4gICAgICAgIHNpbGVudCxcbiAgICAgICAgZm9ybWF0OiBjb25zb2xlRm9ybWF0LFxuICAgICAgfSxcbiAgICAgIG9wdGlvbnNcbiAgICApO1xuXG4gICAgdHJhbnNwb3J0cy5wdXNoKG5ldyB3aW5zdG9uLnRyYW5zcG9ydHMuQ29uc29sZShjb25zb2xlT3B0aW9ucykpO1xuICB9XG5cbiAgbG9nZ2VyLmNvbmZpZ3VyZSh7XG4gICAgdHJhbnNwb3J0cyxcbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb25maWd1cmVMb2dnZXIoe1xuICBsb2dzRm9sZGVyID0gZGVmYXVsdHMubG9nc0ZvbGRlcixcbiAganNvbkxvZ3MgPSBkZWZhdWx0cy5qc29uTG9ncyxcbiAgbG9nTGV2ZWwgPSB3aW5zdG9uLmxldmVsLFxuICB2ZXJib3NlID0gZGVmYXVsdHMudmVyYm9zZSxcbiAgc2lsZW50ID0gZGVmYXVsdHMuc2lsZW50LFxufSA9IHt9KSB7XG4gIGlmICh2ZXJib3NlKSB7XG4gICAgbG9nTGV2ZWwgPSAndmVyYm9zZSc7XG4gIH1cblxuICB3aW5zdG9uLmxldmVsID0gbG9nTGV2ZWw7XG4gIGNvbnN0IG9wdGlvbnMgPSB7fTtcblxuICBpZiAobG9nc0ZvbGRlcikge1xuICAgIGlmICghcGF0aC5pc0Fic29sdXRlKGxvZ3NGb2xkZXIpKSB7XG4gICAgICBsb2dzRm9sZGVyID0gcGF0aC5yZXNvbHZlKHByb2Nlc3MuY3dkKCksIGxvZ3NGb2xkZXIpO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgZnMubWtkaXJTeW5jKGxvZ3NGb2xkZXIpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIC8qICovXG4gICAgfVxuICB9XG4gIG9wdGlvbnMuZGlybmFtZSA9IGxvZ3NGb2xkZXI7XG4gIG9wdGlvbnMubGV2ZWwgPSBsb2dMZXZlbDtcbiAgb3B0aW9ucy5zaWxlbnQgPSBzaWxlbnQ7XG5cbiAgaWYgKGpzb25Mb2dzKSB7XG4gICAgb3B0aW9ucy5qc29uID0gdHJ1ZTtcbiAgICBvcHRpb25zLnN0cmluZ2lmeSA9IHRydWU7XG4gIH1cbiAgY29uZmlndXJlVHJhbnNwb3J0cyhvcHRpb25zKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFkZFRyYW5zcG9ydCh0cmFuc3BvcnQpIHtcbiAgLy8gd2Ugd2lsbCByZW1vdmUgdGhlIGV4aXN0aW5nIHRyYW5zcG9ydFxuICAvLyBiZWZvcmUgcmVwbGFjaW5nIGl0IHdpdGggYSBuZXcgb25lXG4gIHJlbW92ZVRyYW5zcG9ydCh0cmFuc3BvcnQubmFtZSk7XG5cbiAgbG9nZ2VyLmFkZCh0cmFuc3BvcnQpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVtb3ZlVHJhbnNwb3J0KHRyYW5zcG9ydCkge1xuICBjb25zdCBtYXRjaGluZ1RyYW5zcG9ydCA9IGxvZ2dlci50cmFuc3BvcnRzLmZpbmQodDEgPT4ge1xuICAgIHJldHVybiB0eXBlb2YgdHJhbnNwb3J0ID09PSAnc3RyaW5nJ1xuICAgICAgPyB0MS5uYW1lID09PSB0cmFuc3BvcnRcbiAgICAgIDogdDEgPT09IHRyYW5zcG9ydDtcbiAgfSk7XG5cbiAgaWYgKG1hdGNoaW5nVHJhbnNwb3J0KSB7XG4gICAgbG9nZ2VyLnJlbW92ZShtYXRjaGluZ1RyYW5zcG9ydCk7XG4gIH1cbn1cblxuZXhwb3J0IHsgbG9nZ2VyIH07XG5leHBvcnQgZGVmYXVsdCBsb2dnZXI7XG4iXX0=