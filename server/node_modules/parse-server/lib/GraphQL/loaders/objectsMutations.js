"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.load = exports.deleteObject = exports.updateObject = exports.createObject = void 0;

var _graphql = require("graphql");

var defaultGraphQLTypes = _interopRequireWildcard(require("./defaultGraphQLTypes"));

var _rest = _interopRequireDefault(require("../../rest"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {}; if (desc.get || desc.set) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } } newObj.default = obj; return newObj; } }

const parseMap = {
  _op: '__op'
};

const transformToParse = fields => {
  if (!fields || typeof fields !== 'object') {
    return;
  }

  Object.keys(fields).forEach(fieldName => {
    const fieldValue = fields[fieldName];

    if (parseMap[fieldName]) {
      delete fields[fieldName];
      fields[parseMap[fieldName]] = fieldValue;
    }

    if (typeof fieldValue === 'object') {
      transformToParse(fieldValue);
    }
  });
};

const createObject = async (className, fields, config, auth, info) => {
  if (!fields) {
    fields = {};
  }

  transformToParse(fields);
  return (await _rest.default.create(config, auth, className, fields, info.clientSDK)).response;
};

exports.createObject = createObject;

const updateObject = async (className, objectId, fields, config, auth, info) => {
  if (!fields) {
    fields = {};
  }

  transformToParse(fields);
  return (await _rest.default.update(config, auth, className, {
    objectId
  }, fields, info.clientSDK)).response;
};

exports.updateObject = updateObject;

const deleteObject = async (className, objectId, config, auth, info) => {
  await _rest.default.del(config, auth, className, objectId, info.clientSDK);
  return true;
};

exports.deleteObject = deleteObject;

const load = parseGraphQLSchema => {
  parseGraphQLSchema.graphQLObjectsMutations.create = {
    description: 'The create mutation can be used to create a new object of a certain class.',
    args: {
      className: defaultGraphQLTypes.CLASS_NAME_ATT,
      fields: defaultGraphQLTypes.FIELDS_ATT
    },
    type: new _graphql.GraphQLNonNull(defaultGraphQLTypes.CREATE_RESULT),

    async resolve(_source, args, context) {
      try {
        const {
          className,
          fields
        } = args;
        const {
          config,
          auth,
          info
        } = context;
        return await createObject(className, fields, config, auth, info);
      } catch (e) {
        parseGraphQLSchema.handleError(e);
      }
    }

  };
  parseGraphQLSchema.graphQLObjectsMutations.update = {
    description: 'The update mutation can be used to update an object of a certain class.',
    args: {
      className: defaultGraphQLTypes.CLASS_NAME_ATT,
      objectId: defaultGraphQLTypes.OBJECT_ID_ATT,
      fields: defaultGraphQLTypes.FIELDS_ATT
    },
    type: new _graphql.GraphQLNonNull(defaultGraphQLTypes.UPDATE_RESULT),

    async resolve(_source, args, context) {
      try {
        const {
          className,
          objectId,
          fields
        } = args;
        const {
          config,
          auth,
          info
        } = context;
        return await updateObject(className, objectId, fields, config, auth, info);
      } catch (e) {
        parseGraphQLSchema.handleError(e);
      }
    }

  };
  parseGraphQLSchema.graphQLObjectsMutations.delete = {
    description: 'The delete mutation can be used to delete an object of a certain class.',
    args: {
      className: defaultGraphQLTypes.CLASS_NAME_ATT,
      objectId: defaultGraphQLTypes.OBJECT_ID_ATT
    },
    type: new _graphql.GraphQLNonNull(_graphql.GraphQLBoolean),

    async resolve(_source, args, context) {
      try {
        const {
          className,
          objectId
        } = args;
        const {
          config,
          auth,
          info
        } = context;
        return await deleteObject(className, objectId, config, auth, info);
      } catch (e) {
        parseGraphQLSchema.handleError(e);
      }
    }

  };
  const objectsMutation = new _graphql.GraphQLObjectType({
    name: 'ObjectsMutation',
    description: 'ObjectsMutation is the top level type for objects mutations.',
    fields: parseGraphQLSchema.graphQLObjectsMutations
  });
  parseGraphQLSchema.graphQLTypes.push(objectsMutation);
  parseGraphQLSchema.graphQLMutations.objects = {
    description: 'This is the top level for objects mutations.',
    type: objectsMutation,
    resolve: () => new Object()
  };
};

exports.load = load;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9HcmFwaFFML2xvYWRlcnMvb2JqZWN0c011dGF0aW9ucy5qcyJdLCJuYW1lcyI6WyJwYXJzZU1hcCIsIl9vcCIsInRyYW5zZm9ybVRvUGFyc2UiLCJmaWVsZHMiLCJPYmplY3QiLCJrZXlzIiwiZm9yRWFjaCIsImZpZWxkTmFtZSIsImZpZWxkVmFsdWUiLCJjcmVhdGVPYmplY3QiLCJjbGFzc05hbWUiLCJjb25maWciLCJhdXRoIiwiaW5mbyIsInJlc3QiLCJjcmVhdGUiLCJjbGllbnRTREsiLCJyZXNwb25zZSIsInVwZGF0ZU9iamVjdCIsIm9iamVjdElkIiwidXBkYXRlIiwiZGVsZXRlT2JqZWN0IiwiZGVsIiwibG9hZCIsInBhcnNlR3JhcGhRTFNjaGVtYSIsImdyYXBoUUxPYmplY3RzTXV0YXRpb25zIiwiZGVzY3JpcHRpb24iLCJhcmdzIiwiZGVmYXVsdEdyYXBoUUxUeXBlcyIsIkNMQVNTX05BTUVfQVRUIiwiRklFTERTX0FUVCIsInR5cGUiLCJHcmFwaFFMTm9uTnVsbCIsIkNSRUFURV9SRVNVTFQiLCJyZXNvbHZlIiwiX3NvdXJjZSIsImNvbnRleHQiLCJlIiwiaGFuZGxlRXJyb3IiLCJPQkpFQ1RfSURfQVRUIiwiVVBEQVRFX1JFU1VMVCIsImRlbGV0ZSIsIkdyYXBoUUxCb29sZWFuIiwib2JqZWN0c011dGF0aW9uIiwiR3JhcGhRTE9iamVjdFR5cGUiLCJuYW1lIiwiZ3JhcGhRTFR5cGVzIiwicHVzaCIsImdyYXBoUUxNdXRhdGlvbnMiLCJvYmplY3RzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7Ozs7OztBQUVBLE1BQU1BLFFBQVEsR0FBRztBQUNmQyxFQUFBQSxHQUFHLEVBQUU7QUFEVSxDQUFqQjs7QUFJQSxNQUFNQyxnQkFBZ0IsR0FBR0MsTUFBTSxJQUFJO0FBQ2pDLE1BQUksQ0FBQ0EsTUFBRCxJQUFXLE9BQU9BLE1BQVAsS0FBa0IsUUFBakMsRUFBMkM7QUFDekM7QUFDRDs7QUFDREMs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QXBDLEdBQThDO0FBQzVDdkIsSUFBQUEsV0FBVyxFQUFFLDhDQUQrQjtBQUU1Q0ssSUFBQUEsSUFBSSxFQUFFWSxlQUZzQztBQUc1Q1QsSUFBQUEsT0FBTyxFQUFFLE1BQU0sSUFBSTlCLE1BQUo7QUFINkIsR0FBOUM7QUFLRCxDQWpGRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEdyYXBoUUxOb25OdWxsLCBHcmFwaFFMQm9vbGVhbiwgR3JhcGhRTE9iamVjdFR5cGUgfSBmcm9tICdncmFwaHFsJztcbmltcG9ydCAqIGFzIGRlZmF1bHRHcmFwaFFMVHlwZXMgZnJvbSAnLi9kZWZhdWx0R3JhcGhRTFR5cGVzJztcbmltcG9ydCByZXN0IGZyb20gJy4uLy4uL3Jlc3QnO1xuXG5jb25zdCBwYXJzZU1hcCA9IHtcbiAgX29wOiAnX19vcCcsXG59O1xuXG5jb25zdCB0cmFuc2Zvcm1Ub1BhcnNlID0gZmllbGRzID0+IHtcbiAgaWYgKCFmaWVsZHMgfHwgdHlwZW9mIGZpZWxkcyAhPT0gJ29iamVjdCcpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgT2JqZWN0LmtleXMoZmllbGRzKS5mb3JFYWNoKGZpZWxkTmFtZSA9PiB7XG4gICAgY29uc3QgZmllbGRWYWx1ZSA9IGZpZWxkc1tmaWVsZE5hbWVdO1xuICAgIGlmIChwYXJzZU1hcFtmaWVsZE5hbWVdKSB7XG4gICAgICBkZWxldGUgZmllbGRzW2ZpZWxkTmFtZV07XG4gICAgICBmaWVsZHNbcGFyc2VNYXBbZmllbGROYW1lXV0gPSBmaWVsZFZhbHVlO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGZpZWxkVmFsdWUgPT09ICdvYmplY3QnKSB7XG4gICAgICB0cmFuc2Zvcm1Ub1BhcnNlKGZpZWxkVmFsdWUpO1xuICAgIH1cbiAgfSk7XG59O1xuXG5jb25zdCBjcmVhdGVPYmplY3QgPSBhc3luYyAoY2xhc3NOYW1lLCBmaWVsZHMsIGNvbmZpZywgYXV0aCwgaW5mbykgPT4ge1xuICBpZiAoIWZpZWxkcykge1xuICAgIGZpZWxkcyA9IHt9O1xuICB9XG5cbiAgdHJhbnNmb3JtVG9QYXJzZShmaWVsZHMpO1xuXG4gIHJldHVybiAoYXdhaXQgcmVzdC5jcmVhdGUoY29uZmlnLCBhdXRoLCBjbGFzc05hbWUsIGZpZWxkcywgaW5mby5jbGllbnRTREspKVxuICAgIC5yZXNwb25zZTtcbn07XG5cbmNvbnN0IHVwZGF0ZU9iamVjdCA9IGFzeW5jIChcbiAgY2xhc3NOYW1lLFxuICBvYmplY3RJZCxcbiAgZmllbGRzLFxuICBjb25maWcsXG4gIGF1dGgsXG4gIGluZm9cbikgPT4ge1xuICBpZiAoIWZpZWxkcykge1xuICAgIGZpZWxkcyA9IHt9O1xuICB9XG5cbiAgdHJhbnNmb3JtVG9QYXJzZShmaWVsZHMpO1xuXG4gIHJldHVybiAoYXdhaXQgcmVzdC51cGRhdGUoXG4gICAgY29uZmlnLFxuICAgIGF1dGgsXG4gICAgY2xhc3NOYW1lLFxuICAgIHsgb2JqZWN0SWQgfSxcbiAgICBmaWVsZHMsXG4gICAgaW5mby5jbGllbnRTREtcbiAgKSkucmVzcG9uc2U7XG59O1xuXG5jb25zdCBkZWxldGVPYmplY3QgPSBhc3luYyAoY2xhc3NOYW1lLCBvYmplY3RJZCwgY29uZmlnLCBhdXRoLCBpbmZvKSA9PiB7XG4gIGF3YWl0IHJlc3QuZGVsKGNvbmZpZywgYXV0aCwgY2xhc3NOYW1lLCBvYmplY3RJZCwgaW5mby5jbGllbnRTREspO1xuICByZXR1cm4gdHJ1ZTtcbn07XG5cbmNvbnN0IGxvYWQgPSBwYXJzZUdyYXBoUUxTY2hlbWEgPT4ge1xuICBwYXJzZUdyYXBoUUxTY2hlbWEuZ3JhcGhRTE9iamVjdHNNdXRhdGlvbnMuY3JlYXRlID0ge1xuICAgIGRlc2NyaXB0aW9uOlxuICAgICAgJ1RoZSBjcmVhdGUgbXV0YXRpb24gY2FuIGJlIHVzZWQgdG8gY3JlYXRlIGEgbmV3IG9iamVjdCBvZiBhIGNlcnRhaW4gY2xhc3MuJyxcbiAgICBhcmdzOiB7XG4gICAgICBjbGFzc05hbWU6IGRlZmF1bHRHcmFwaFFMVHlwZXMuQ0xBU1NfTkFNRV9BVFQsXG4gICAgICBmaWVsZHM6IGRlZmF1bHRHcmFwaFFMVHlwZXMuRklFTERTX0FUVCxcbiAgICB9LFxuICAgIHR5cGU6IG5ldyBHcmFwaFFMTm9uTnVsbChkZWZhdWx0R3JhcGhRTFR5cGVzLkNSRUFURV9SRVNVTFQpLFxuICAgIGFzeW5jIHJlc29sdmUoX3NvdXJjZSwgYXJncywgY29udGV4dCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgeyBjbGFzc05hbWUsIGZpZWxkcyB9ID0gYXJncztcbiAgICAgICAgY29uc3QgeyBjb25maWcsIGF1dGgsIGluZm8gfSA9IGNvbnRleHQ7XG5cbiAgICAgICAgcmV0dXJuIGF3YWl0IGNyZWF0ZU9iamVjdChjbGFzc05hbWUsIGZpZWxkcywgY29uZmlnLCBhdXRoLCBpbmZvKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgcGFyc2VHcmFwaFFMU2NoZW1hLmhhbmRsZUVycm9yKGUpO1xuICAgICAgfVxuICAgIH0sXG4gIH07XG5cbiAgcGFyc2VHcmFwaFFMU2NoZW1hLmdyYXBoUUxPYmplY3RzTXV0YXRpb25zLnVwZGF0ZSA9IHtcbiAgICBkZXNjcmlwdGlvbjpcbiAgICAgICdUaGUgdXBkYXRlIG11dGF0aW9uIGNhbiBiZSB1c2VkIHRvIHVwZGF0ZSBhbiBvYmplY3Qgb2YgYSBjZXJ0YWluIGNsYXNzLicsXG4gICAgYXJnczoge1xuICAgICAgY2xhc3NOYW1lOiBkZWZhdWx0R3JhcGhRTFR5cGVzLkNMQVNTX05BTUVfQVRULFxuICAgICAgb2JqZWN0SWQ6IGRlZmF1bHRHcmFwaFFMVHlwZXMuT0JKRUNUX0lEX0FUVCxcbiAgICAgIGZpZWxkczogZGVmYXVsdEdyYXBoUUxUeXBlcy5GSUVMRFNfQVRULFxuICAgIH0sXG4gICAgdHlwZTogbmV3IEdyYXBoUUxOb25OdWxsKGRlZmF1bHRHcmFwaFFMVHlwZXMuVVBEQVRFX1JFU1VMVCksXG4gICAgYXN5bmMgcmVzb2x2ZShfc291cmNlLCBhcmdzLCBjb250ZXh0KSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB7IGNsYXNzTmFtZSwgb2JqZWN0SWQsIGZpZWxkcyB9ID0gYXJncztcbiAgICAgICAgY29uc3QgeyBjb25maWcsIGF1dGgsIGluZm8gfSA9IGNvbnRleHQ7XG5cbiAgICAgICAgcmV0dXJuIGF3YWl0IHVwZGF0ZU9iamVjdChcbiAgICAgICAgICBjbGFzc05hbWUsXG4gICAgICAgICAgb2JqZWN0SWQsXG4gICAgICAgICAgZmllbGRzLFxuICAgICAgICAgIGNvbmZpZyxcbiAgICAgICAgICBhdXRoLFxuICAgICAgICAgIGluZm9cbiAgICAgICAgKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgcGFyc2VHcmFwaFFMU2NoZW1hLmhhbmRsZUVycm9yKGUpO1xuICAgICAgfVxuICAgIH0sXG4gIH07XG5cbiAgcGFyc2VHcmFwaFFMU2NoZW1hLmdyYXBoUUxPYmplY3RzTXV0YXRpb25zLmRlbGV0ZSA9IHtcbiAgICBkZXNjcmlwdGlvbjpcbiAgICAgICdUaGUgZGVsZXRlIG11dGF0aW9uIGNhbiBiZSB1c2VkIHRvIGRlbGV0ZSBhbiBvYmplY3Qgb2YgYSBjZXJ0YWluIGNsYXNzLicsXG4gICAgYXJnczoge1xuICAgICAgY2xhc3NOYW1lOiBkZWZhdWx0R3JhcGhRTFR5cGVzLkNMQVNTX05BTUVfQVRULFxuICAgICAgb2JqZWN0SWQ6IGRlZmF1bHRHcmFwaFFMVHlwZXMuT0JKRUNUX0lEX0FUVCxcbiAgICB9LFxuICAgIHR5cGU6IG5ldyBHcmFwaFFMTm9uTnVsbChHcmFwaFFMQm9vbGVhbiksXG4gICAgYXN5bmMgcmVzb2x2ZShfc291cmNlLCBhcmdzLCBjb250ZXh0KSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB7IGNsYXNzTmFtZSwgb2JqZWN0SWQgfSA9IGFyZ3M7XG4gICAgICAgIGNvbnN0IHsgY29uZmlnLCBhdXRoLCBpbmZvIH0gPSBjb250ZXh0O1xuXG4gICAgICAgIHJldHVybiBhd2FpdCBkZWxldGVPYmplY3QoY2xhc3NOYW1lLCBvYmplY3RJZCwgY29uZmlnLCBhdXRoLCBpbmZvKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgcGFyc2VHcmFwaFFMU2NoZW1hLmhhbmRsZUVycm9yKGUpO1xuICAgICAgfVxuICAgIH0sXG4gIH07XG5cbiAgY29uc3Qgb2JqZWN0c011dGF0aW9uID0gbmV3IEdyYXBoUUxPYmplY3RUeXBlKHtcbiAgICBuYW1lOiAnT2JqZWN0c011dGF0aW9uJyxcbiAgICBkZXNjcmlwdGlvbjogJ09iamVjdHNNdXRhdGlvbiBpcyB0aGUgdG9wIGxldmVsIHR5cGUgZm9yIG9iamVjdHMgbXV0YXRpb25zLicsXG4gICAgZmllbGRzOiBwYXJzZUdyYXBoUUxTY2hlbWEuZ3JhcGhRTE9iamVjdHNNdXRhdGlvbnMsXG4gIH0pO1xuICBwYXJzZUdyYXBoUUxTY2hlbWEuZ3JhcGhRTFR5cGVzLnB1c2gob2JqZWN0c011dGF0aW9uKTtcblxuICBwYXJzZUdyYXBoUUxTY2hlbWEuZ3JhcGhRTE11dGF0aW9ucy5vYmplY3RzID0ge1xuICAgIGRlc2NyaXB0aW9uOiAnVGhpcyBpcyB0aGUgdG9wIGxldmVsIGZvciBvYmplY3RzIG11dGF0aW9ucy4nLFxuICAgIHR5cGU6IG9iamVjdHNNdXRhdGlvbixcbiAgICByZXNvbHZlOiAoKSA9PiBuZXcgT2JqZWN0KCksXG4gIH07XG59O1xuXG5leHBvcnQgeyBjcmVhdGVPYmplY3QsIHVwZGF0ZU9iamVjdCwgZGVsZXRlT2JqZWN0LCBsb2FkIH07XG4iXX0=